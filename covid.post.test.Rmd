---
title: "Post test probability of disease in sympomatic and asymptomatic adult after negative BinaxNOW rapid antigen coronavirus test under varying pre-test probabilities "
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
 library(latex2exp)
```

# Summary:

I have been thinking more about this in the past weeks. Some months ago, I wanted to, given what I had available, try to determine the post-test probability of covid-19 in a person who had a negative Binax NOW rapid antigen test after a sustained exposure (of course, every time you contract the disease, you must be exposed in some form, but, in this case, I defined “exposure” as an unmasked, sustained contact). Originally, I hoped we could apply Bayes' rule to some estimates from the literature. Note, however, that the estimates in the literature do not take into account the extra variable that we call “exposure,” and so I gave up before. However, assuming that we have all necessary variables besides exposure (a strong assumption), we still have a sort of bound at least, which might still be useful, even if only to show us how little we actually know, even when making a strong assumption.

# Screening:

We would ignore this extra variable if we were “screening,” or randomly checking whether we have covid-19. In this case, we are not taking the test "because of something that happened,” but just because. However, “screening” is elusive — e.g., even if one believes that one is “screening,” if one is doing so in order to determine whether it is safe to return home for the holiday, the fact that it is holiday season seems to actually make it so that they are no longer “screening”. In that case, one is testing because it is near the holiday, and the holiday season affects the pre-test probability. Hence, one is rarely "screening," and there is a need to take other variables into account (Moons 2003).

The event “sustained exposure” is essentially one of those "other variables." I have therefore been trying to deal with the fact that we have this other information that is not taken into account in Prince-Guerra 2021 (I am not even sure whether they could have taken it into account). I have mostly just been writing out probability statements, and not made a ton of headway, but at least it seems there is a bound, which is common sense in retrospect.

# Bound:

based on Prince-Guerra 2021, define sx=symptoms, ad = adult, and dz=disease.   Further, define exposure=sustained exposure. We can just compare the two quantities,

$$
P(dz+|sx,ad)
$$

and

$$
P(dz+|sx,ad,exposure),
$$

and we know that the second must be greater than the first.

We can also somewhat more circuitously write

$$
P(dz+|test-,sx,ad,exposure + )=\frac{P(exposure+|test-,dz+,sx,ad)}{P(exposure+|test-,sx,ad)}P(dz+|sx,ad,test-)
$$

We see that if

$$
\frac{P(exposure+|test-,dz+,sx,ad)}{P(exposure+|test-,sx,ad)}>1,
$$

which is the case when the event “exposure” increases the probability of the disease (I assume this is true), then

$$
P(dz+|sx,ad,test-),
$$

which we can obtain from Prince-Guerra 2021, is a lower bound on

$$
P(dz+|exposure+,sx,ad,test-).
$$

So, even though the estimates in Prince-Guerra do not apply to our situation directly, we can use them to obtain a lower bound on our post-test probability. It is still not clear whether this is even the true lower bound. When there are multiple factors that we are conditioning on, and when some of these factors have an unknown relationship with the disease status, then we can no longer even make definitive statements about the bound. However, if we were to assume that other variables, besides those concerning age cutoff, symptom status, test result, and exposure, are negligible, our post-test probability estimate can still be considered a lower bound, which still gives us some information, and also shows us, even with our strong assumptions, how little we actually know (I am reposting it here from above, but note now that I call the line a lower bound - also, I re-added the grid lines, which were lost before).


From Prince-Guerra et al (2021) [2], we have point estimates and 95% confidence intervals for

$$
P(test+|dz+,sx+,ad+) \approx 0.64 \ (0.57,0.71)
$$

and

$$
P(test+|dz+,sx-,ad+) \approx 0.36 \ (0.27,0.45).
$$

Also (todo: maybe I should have left this to two decimals),

$$
P(dz-|test-,sx-,ad+)\approx 1 (1,1)
$$

and

$$
P(dz-|test-,sx+,ad+)\approx 1 (1,1).
$$

Now,

$$
\begin{aligned}
P(dz+|test-,sx)&=\frac{P(test-|dz+,sx)}{P(test-|sx)}P(dz+|sx)\\
&=\frac{1-P(test+|dz+,sx)}{P(test-|dz-,sx)P(dz-|sx)+P(test-|dz+,sx)P(dz+|sx)}P(dz+|sx).
\end{aligned}
$$

I am concerned with the omission of gender, which appears to be possibly correlated with viral load (Mahallawi 2021). I think age should be treated as a continuous variable. It seems that age should correlate with viral load; this was not supported by Mahallawi, but it might be supported by Sjoerd, 2021. We need to condition on anything that leads to different antigen levels in different people. If the antigens are excreted or metabolized, we would need to take into account liver and kidney status. Of course, this should depend on immune system function, which will vary along with comorbidities and medications. Antigen level also probably depends on the covid strain. I am also unsure how one should estimate $P(dz+|sx,ad).$ We can get this for the Prince-Guerra 2021 cohort, but this depends on things like location, time of year, and lockdown status. Some of these have changed a lot since the study was conducted.

# Ideally:

Note that age is given to us as "adult" - a large loss of info, symptom status is binarized, test result is binarized, and exposure was binarized by me, unfortunately (although we could just treat it as continuous).

Note that to obtain the graph above, we are working with what we have available. However, the following would be ideal: every time one takes a test, one goes to a website and enters information such as age, sex, zip code, and test result. The website then calculates post-test probability based on a model for, explicitily,

$$
P(dz+|test=r,age=a,sex=s,symptoms=sx,zip=z,..)
$$

The model would be updated in real-time based on geographically and temporally relevant statistics. Note that this post-test probability would depend very much on time, and therefore the model would have to be updated probably each day. It seems though that, barring sampling issues, we have this data. There is observational data collected when people report their test results (in other words, we collect information such as age, zip code, etc). Often, also, we have a PCR confirmation. It is unclear however whether we will have enough of the variables mentioned above, which are still necessary.

Also, ideally, the test result would be a continuous variable (eg, amount of viral load). This may be difficult due to at-home testing kit constraints. However, it seems currently that there is some cutoff above which a test is called positive. If it is possible for the tests to convey more information, such as through color or some type of numerical scale, it would lead to better estimates of the post-test probability (assuming there is no real hard cutoff - I am not sure).

# On the test cutoff (if there is a cutoff):

It is not clear this is how it works, but, in general, test cutoffs have highly significant implications. If indeed there is a cutoff, what is the reward function that is being optimized? It appears that these tests were designed to minimize false positive results. However, that is not, in general, always a good idea. Decreasing false positives (e.g., by setting a high cutoff) also increases false negatives. In general, for someone who works in a highly populated area, or with vulnerable populations, a false negative is worse than a false positive.

# Serial testing:

I have also done some more thinking on serial testing - my current thinking (maybe this is not correct, I need to still write it out here) is that **if the tests are independent**, you can essentially treat the post-test probability from the first test as the pre-test probability for the second. If this is the case, then two tests taken, premeditated, in sequence, will perform like a better test. I hope to eventually provide a post-test graph, as above, for independent sequential tests. Assuming we have conditioned on everything we need, it will still give a lower bound for the “exposure” case.

Generally, though, it is also advised to take the two tests e.g. 24 hours apart to see if the viral load increases during that time. I am not sure that two tests that are taken like this are still independent.

# Positive tests:

Note that I am focusing only on the negative test case, although you could do the same for positive tests (I said originally that this was a non-issue, but I should not have — you can, of course, have a positive test with no disease, and I should repeat the analysis above for that case).


Likelihood ratio
```{r }
like.rat=function(sens,spec,pretest){(1-sens)/((1-sens)*pretest+(spec)*(1-pretest))}
```

posterior probability of disease given negative test is likelihood ratio * prior


```{r }
post.test.prob = function(sens,spec,pretest){
  like.rat(sens=sens,spec=spec,pretest=pretest)*pretest
}
```

compute over a grid of priors

```{r }
pre.tests = seq(0,1,0.01)
get.post.tests = function(sens,spec,pretests){
post.tests = c()
for(i in 1:length(pre.tests)){
  post.tests[i]=post.test.prob(sens=sens,spec=spec,pretest=pre.tests[i])
}
post.tests
}
```

compute using, from Prince-Guerra 2021, 
$$
 P(test+|dz+,sx+,ad+)\approx 0.64 (0.57,0.71)")
$$
 and
 
$$
P(test+|dz+,sz-,ad+) \approx 0.36 (0.27,0.45)")
$$

```{r }

plot.p = function(post.tests.6,post.tests.6l,post.tests.6u,
                  post.tests.36,post.tests.36u,post.tests.36l,post.label){
lwd.point = 2
plot(pre.tests,post.tests.6,type='l',
     xlab="Pre-test: P(dz+|sx,ad)",ylab=post.label,
     lty=1,lwd=lwd.point,
     main=('Lower bound of post-test prob given exp, 
           neg BinaxNOW test\n (sx=symptoms, ad=adult)'))
lines(pre.tests,post.tests.6u,lty=2,col=1)
lines(pre.tests,post.tests.6l,lty=2,col=1)
xseq = seq(0,1,0.1)
yseq = seq(0,1,0.1)
for(x in xseq){
  abline(v=x,col='gray')
}

for(y in yseq){
  abline(h=y,col='gray')
}

lines(pre.tests,post.tests.36,lty=1,lwd=lwd.point,col=2)
lines(pre.tests,post.tests.36u,lty=2,col=2)
lines(pre.tests,post.tests.36l,lty=2,col=2)
legend("topleft",
       c(TeX("sx+,ad+"),TeX("sx-,ad+")),
       lty=c(1,1),col=c(1,2),lwd=c(lwd.point,lwd.point))
}
```

```{r }
post.tests.6=get.post.tests(sens=0.64,spec=1,pretests)
post.tests.6l=get.post.tests(sens=0.57,spec=1,pretests)
post.tests.6u=get.post.tests(sens=0.71,spec=1,pretests)

post.tests.36=get.post.tests(sens=0.36,spec=1,pretests)
post.tests.36u = get.post.tests(sens=.45,spec=1,pretests)
post.tests.36l = get.post.tests(sens=.27, spec=1,pretests)

png("post.test.png")
plot.p(post.tests.6,post.tests.6l,post.tests.6u,
                  post.tests.36,post.tests.36u,post.tests.36l,
       "Lower Bound Post-test: P(dz+|test-,sx,ad)")
dev.off()
plot.p(post.tests.6,post.tests.6l,post.tests.6u,
                  post.tests.36,post.tests.36u,post.tests.36l,
       "Lower Bound Post-test: P(dz+|test-,sx,ad)")
```



Code: [github](https://github.com/samuelweisenthal/BinaxNOWpostTestProb)

References:

Moons, Karel GM, and Frank E. Harrell. “Sensitivity and specificity should be de-emphasized in diagnostic accuracy studies.” Academic radiology 10.6 (2003): 670-672. [http://hbiostat.org/papers/feh/moons.radiology.pdf ](http://hbiostat.org/papers/feh/moons.radiology.pdf)

Prince-Guerra JL, Almendares O, Nolen LD, Gunn JKL, Dale AP, Buono SA, Deutsch-Feldman M, Suppiah S, Hao L, Zeng Y, Stevens VA, Knipe K, Pompey J, Atherstone C, Bui DP, Powell T, Tamin A, Harcourt JL, Shewmaker PL, Medrzycki M, Wong P, Jain S, Tejada-Strop A, Rogers S, Emery B, Wang H, Petway M, Bohannon C, Folster JM, MacNeil A, Salerno R, Kuhnert-Tallman W, Tate JE, Thornburg NJ, Kirking HL, Sheiban K, Kudrna J, Cullen T, Komatsu KK, Villanueva JM, Rose DA, Neatherlin JC, Anderson M, Rota PA, Honein MA, Bower WA. Evaluation of Abbott BinaxNOW Rapid Antigen Test for SARS-CoV-2 Infection at Two Community-Based Testing Sites - Pima County, Arizona, November 3-17, 2020. MMWR Morb Mortal Wkly Rep. 2021 Jan 22;70(3):100-105. doi: 10.15585/mmwr.mm7003e3. Erratum in: MMWR Morb Mortal Wkly Rep. 2021 Jan 29;70(4):144. PMID: 33476316; PMCID: PMC7821766. https://www.cdc.gov/mmwr/volumes/70/wr/pdfs/mm7003e3-H.pdf

Mahallawi WH, Alsamiri AD, Dabbour AF, Alsaeedi H, Al-Zalabani AH. Association of Viral Load in SARS-CoV-2 Patients With Age and Gender. *Front Med (Lausanne)*. 2021;8:608215. Published 2021 Jan 27. doi:10.3389/fmed.2021.608215

Sjoerd Euser, Sem Aronson, Irene Manders, Steven van Lelyveld, Bjorn Herpers, Jan Sinnige, Jayant Kalpoe, Claudia van Gemeren, Dominic Snijders, Ruud Jansen, Sophie Schuurmans Stekhoven, Marlies van Houten, Ivar Lede, James Cohen Stuart, Fred Slijkerman Megelink, Erik Kapteijns, Jeroen den Boer, Elisabeth Sanders, Alex Wagemakers, Dennis Souverein, SARS-CoV-2 viral-load distribution reveals that viral loads increase with age: a retrospective cross-sectional cohort study, *International Journal of Epidemiology*, 2021;, dyab145, https://doi.org/10.1093/ije/dyab145

I appreciate conversations with the datamethods forum participants (Diana Petitti, James Meyer. ), Anna Park, and my brother on this topic.
